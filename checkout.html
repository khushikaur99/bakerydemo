<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Cart - Cakes Online Monginis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
        :root {
            --primary: #3d1106; /* Dark Brown */
            --secondary: #8B4513; /* Slightly lighter brown for contrast */
            --background: #F5E8C7; /* Light beige background */
            --text: #333333; /* Dark gray for text */
            --light-text: #666666; /* Lighter gray for secondary text */
        }
        .bg-primary { background-color: var(--primary); }
        .border-primary { border-color: var(--primary); }
        .text-primary { color: var(--primary); }
        .bg-secondary { background-color: var(--secondary); }
        .text-secondary { color: var(--secondary); }
        .bg-background { background-color: var(--background); }
        .text-background { color: var(--background); }
        .text-dark { color: var(--text); }
        .text-light { color: var(--light-text); }
        .hover\:bg-primary-hover:hover { background-color: #3A1700; } /* Darker shade for hover */

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 5px;
            width: 90%;
            max-width: 400px;
            position: relative;
        }
        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-background min-h-screen text-dark">
    <!-- Header Container -->
    <div id="header"></div>

    <div class="container mx-auto px-4 py-4 max-w-6xl">
        <div class="flex gap-8">
            <!-- Left Column: Cart Items and Form Fields -->
            <div class="flex-1">
                <!-- Cart Items -->
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <div id="cartItems" class="space-y-4">
                        <!-- Items will be populated by script -->
                    </div>
                </div>

                <!-- Add More Items Button -->
                <button id="addMoreItems" class="bg-primary text-white px-6 py-2 rounded w-full mb-4 hover:bg-primary-hover">
                    ADD MORE ITEMS
                </button>

                <!-- Select Delivery Date and Time -->
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h3 class="font-semibold mb-2 text-dark">Select Delivery Date</h3>
                    <div class="flex space-x-2 mb-2">
                        <button id="today" class="bg-white border border-primary text-primary px-4 py-1 rounded">Today</button>
                        <button id="customDate" class="bg-white border border-primary text-primary px-4 py-1 rounded">Custom Date</button>
                    </div>
                    <div id="dateTimeDisplay" class="flex items-center justify-between text-dark">
                        <span id="selectedDate">Today, September 11, 2025, 02:45 PM IST</span>
                        <select id="deliveryTime" class="border border-primary rounded px-3 py-1 text-dark">
                            <option value="1:00PM to 3:00PM">1:00PM to 3:00PM</option>
                            <option value="3:00PM to 5:00PM">3:00PM to 5:00PM</option>
                            <option value="5:00PM to 7:00PM">5:00PM to 7:00PM</option>
                        </select>
                    </div>
                    <div id="calendarContainer" class="mt-2 hidden">
                        <input type="text" id="datePicker" class="border border-primary rounded px-3 py-1 w-full text-dark">
                    </div>
                </div>

                <!-- Order Details Form -->
                <div class="bg-white rounded-lg shadow-sm p-4">
                    <!-- Order Booked By -->
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 text-dark">Order Booked By</label>
                            <div class="flex items-center border border-primary rounded px-2 py-1">
                                <i class="fas fa-user mr-2 text-light"></i>
                                <input type="text" id="orderName" placeholder="Your Name" class="w-full outline-none text-dark">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 text-dark">&nbsp;</label>
                            <div class="flex items-center border border-primary rounded px-2 py-1">
                                <i class="fas fa-phone mr-2 text-light"></i>
                                <input type="tel" id="orderPhone" placeholder="0000000000" class="w-full outline-none text-dark" pattern="[0-9]{10}">
                            </div>
                        </div>
                    </div>

                    <!-- Delivery Address -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 text-dark">Delivery Address</label>
                        <div id="addressOptions" class="space-y-4">
                            <div class="bg-white border border-primary rounded-lg p-3 shadow-md">
                                <label class="flex items-center justify-between">
                                    <div>
                                        <input type="radio" name="address" value="Home, Bijali Nagar, Aurdi, Bijali Nagae, 411061" class="mr-2" checked>
                                        <span class="text-dark">Home, Bijali Nagar, Aurdi, Bijali Nagae, 411061</span>
                                    </div>
                                    <button class="edit-address bg-primary text-white px-2 py-1 rounded text-sm hover:bg-primary-hover" data-index="0">Edit</button>
                                </label>
                            </div>
                        </div>
                        <div class="mt-2 flex space-x-2">
                            <button id="addNewAddress" class="bg-primary text-white px-4 py-2 rounded hover:bg-primary-hover">Add New Address</button>
                        </div>
                        <div id="newAddressForm" class="space-y-2 mt-2 hidden">
                            <input type="text" id="newAddress1" placeholder="Address Line 1" class="w-full border border-primary rounded px-3 py-2 text-dark">
                            <input type="text" id="newAddress2" placeholder="Address Line 2" class="w-full border border-primary rounded px-3 py-2 text-dark">
                            <input type="text" id="newZipCode" placeholder="ZIP Code" class="w-full border border-primary rounded px-3 py-2 text-dark">
                            <input type="text" id="newAddressType" placeholder="Home" class="w-full border border-primary rounded px-3 py-2 text-dark">
                            <div class="flex space-x-2 mt-2">
                                <button id="saveNewAddress" class="bg-primary text-white px-4 py-1 rounded hover:bg-primary-hover">Save Address</button>
                                <button id="cancelNewAddress" class="bg-secondary text-white px-4 py-1 rounded hover:bg-primary-hover">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <!-- Alternate Mobile No. -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1 text-dark">Alternate Mobile No.</label>
                        <input type="tel" id="altPhone" placeholder="Enter alternate mobile no." class="w-full border border-primary rounded px-3 py-2 text-dark" pattern="[0-9]{10}">
                    </div>

                    <!-- Payment Method -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1 text-dark">Payment Method</label>
                        <button id="paymentMethod" class="bg-primary text-white px-4 py-1 rounded hover:bg-primary-hover">Online</button>
                    </div>

                    <!-- Order Type -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1 text-dark">Order Type</label>
                        <div class="flex space-x-2">
                            <button id="ownOrder" class="bg-white border border-primary text-primary px-4 py-1 rounded">Own Order</button>
                            <button id="giftOrder" class="bg-white border border-primary text-primary px-4 py-1 rounded hover:bg-primary hover:text-white">Gift Order</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Discount and Summary -->
            <div class="w-80">
                <div class="bg-white rounded-lg shadow-sm p-4 sticky top-4">
                    <!-- Discount -->
                    <h3 class="font-semibold mb-2 text-dark">Discount</h3>
                    <div class="flex items-center mb-2">
                        <input type="text" id="discountCode" placeholder="Enter discount code" class="flex-1 border border-primary rounded-l px-3 py-2 text-dark">
                        <button id="applyDiscount" class="bg-primary text-white px-4 py-2 rounded-r hover:bg-primary-hover">APPLY</button>
                    </div>
                    <a href="#" class="text-primary flex items-center text-sm">
                        <i class="fas fa-percentage mr-1"></i> View Coupons
                    </a>

                    <hr class="my-4">

                    <!-- Summary -->
                    <div id="orderSummary" class="space-y-2 text-sm">
                        <!-- Summary will be populated by script -->
                    </div>

                    <!-- Place Order Button -->
                    <button id="placeOrder" class="bg-secondary text-white px-6 py-2 rounded w-full mt-4 hover:bg-primary-hover">
                        PLACE ORDER
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Gift Order Modal -->
    <div id="giftModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 class="font-semibold text-lg text-dark mb-4">Gift Order Details</h3>
            <div class="space-y-4">
                <input type="text" id="recipientName" placeholder="Recipient Name" class="w-full border border-primary rounded px-3 py-2 text-dark">
                <input type="tel" id="recipientPhone" placeholder="Recipient Phone" class="w-full border border-primary rounded px-3 py-2 text-dark" pattern="[0-9]{10}">
                <textarea id="giftMessage" placeholder="Gift Message (Optional)" class="w-full border border-primary rounded px-3 py-2 text-dark" rows="4"></textarea>
                <button id="saveGiftDetails" class="bg-primary text-white px-4 py-2 rounded w-full hover:bg-primary-hover">Save</button>
            </div>
        </div>
    </div>

    <script>
        // Fetch and include header
        fetch('../Mainheader.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header').innerHTML = data;
            })
            .catch(error => console.error('Error loading header:', error));

        // Load saved addresses from localStorage or initialize with a default
        let addresses = JSON.parse(localStorage.getItem('userAddresses')) || [
            { type: "Home", line1: "Bijali Nagar", line2: "Aurdi", line3: "Bijali Nagae", zip: "411061" }
        ];

        // Load cart items from localStorage (connected to cart.html)
        let cartItems = JSON.parse(localStorage.getItem('cart')) || [];

        // Populate Cart Items
        function renderCartItems() {
            const cartItemsDiv = document.getElementById('cartItems');
            cartItemsDiv.innerHTML = '';
            cartItems.forEach(item => {
                if (item.quantity > 0) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex items-start space-x-4 border-b pb-4';
                    itemDiv.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="w-24 h-24 object-cover rounded">
                        <div class="flex-1">
                            <h3 class="font-semibold text-lg text-dark">${item.name}</h3>
                            <p class="text-sm text-light">${item.description || 'Delicious bakery item'}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-dark">₹${(item.price * item.quantity).toLocaleString('en-IN')}</p>
                            <div class="flex items-center mt-2">
                                <button class="bg-gray-200 px-2 py-1 qty-minus" data-index="${cartItems.indexOf(item)}">-</button>
                                <span class="px-3 text-dark">${item.quantity}</span>
                                <button class="bg-gray-200 px-2 py-1 qty-plus" data-index="${cartItems.indexOf(item)}">+</button>
                            </div>
                        </div>
                        <i class="fas fa-trash text-primary cursor-pointer remove-item" data-index="${cartItems.indexOf(item)}"></i>
                    `;
                    cartItemsDiv.appendChild(itemDiv);
                }
            });
            updateSummary();
        }

        // Render Addresses
        function renderAddresses() {
            const addressOptions = document.getElementById('addressOptions');
            addressOptions.innerHTML = '';
            addresses.forEach((addr, index) => {
                const addressStr = `${addr.type}, ${addr.line1}${addr.line2 ? `, ${addr.line2}` : ''}${addr.line3 ? `, ${addr.line3}` : ''}, ${addr.zip}`;
                const div = document.createElement('div');
                div.className = 'bg-white border border-primary rounded-lg p-3 shadow-md';
                div.innerHTML = `
                    <label class="flex items-center justify-between">
                        <div>
                            <input type="radio" name="address" value="${addressStr}" class="mr-2" ${index === 0 ? 'checked' : ''}>
                            <span class="text-dark">${addressStr}</span>
                        </div>
                        <button class="edit-address bg-primary text-white px-2 py-1 rounded text-sm hover:bg-primary-hover" data-index="${index}">Edit</button>
                    </label>
                `;
                addressOptions.appendChild(div);
            });
            document.getElementById('addNewAddress').style.display = 'block';
        }

        // Delivery Date and Time
        let datePickerInstance;
        document.getElementById('today').addEventListener('click', () => {
            const today = new Date();
            document.getElementById('selectedDate').textContent = `Today, ${today.toLocaleString('en-US', { month: 'long', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true })} IST`;
            if (datePickerInstance) datePickerInstance.destroy();
            document.getElementById('calendarContainer').classList.add('hidden');
        });

        document.getElementById('customDate').addEventListener('click', () => {
            document.getElementById('calendarContainer').classList.remove('hidden');
            if (!datePickerInstance) {
                datePickerInstance = flatpickr('#datePicker', {
                    minDate: new Date(),
                    maxDate: new Date().fp_incr(30),
                    enableTime: true,
                    dateFormat: "F j, Y, h:i K",
                    time_24hr: false,
                    onChange: function(selectedDates, dateStr, instance) {
                        if (selectedDates.length > 0) {
                            document.getElementById('selectedDate').textContent = `${dateStr} IST`;
                        }
                    },
                    onClose: function(selectedDates, dateStr, instance) {
                        document.getElementById('calendarContainer').classList.add('hidden');
                    }
                });
            }
            datePickerInstance.open();
        });

        // Order Booked By and Phone Validation
        document.getElementById('orderPhone').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
        });

        // Delivery Address Management
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('edit-address')) {
                const index = parseInt(e.target.dataset.index);
                const addr = addresses[index];
                document.getElementById('newAddressForm').classList.remove('hidden');
                document.getElementById('addressOptions').classList.add('hidden');
                document.getElementById('newAddressType').value = addr.type || '';
                document.getElementById('newAddress1').value = addr.line1 || '';
                document.getElementById('newAddress2').value = addr.line2 || '';
                document.getElementById('newZipCode').value = addr.zip || '';
                localStorage.setItem('editingAddressIndex', index);
            }
        });

        document.getElementById('addNewAddress').addEventListener('click', () => {
            document.getElementById('newAddressForm').classList.remove('hidden');
            document.getElementById('addressOptions').classList.add('hidden');
            document.getElementById('newAddressType').value = '';
            document.getElementById('newAddress1').value = '';
            document.getElementById('newAddress2').value = '';
            document.getElementById('newZipCode').value = '';
            localStorage.removeItem('editingAddressIndex');
        });

        document.getElementById('saveNewAddress').addEventListener('click', () => {
            const newAddressType = document.getElementById('newAddressType').value || 'Home';
            const newAddress1 = document.getElementById('newAddress1').value.trim();
            const newAddress2 = document.getElementById('newAddress2').value.trim();
            const newZipCode = document.getElementById('newZipCode').value.trim();
            const editingIndex = localStorage.getItem('editingAddressIndex');

            if (newAddress1 && newZipCode) {
                const newAddress = {
                    type: newAddressType,
                    line1: newAddress1,
                    line2: newAddress2,
                    zip: newZipCode
                };
                if (editingIndex !== null) {
                    addresses[editingIndex] = newAddress;
                    localStorage.removeItem('editingAddressIndex');
                } else {
                    addresses.push(newAddress);
                }
                localStorage.setItem('userAddresses', JSON.stringify(addresses));
                renderAddresses();
                document.getElementById('newAddressForm').classList.add('hidden');
                document.getElementById('addressOptions').classList.remove('hidden');
            } else {
                alert('Please fill in the required address fields.');
            }
        });

        document.getElementById('cancelNewAddress').addEventListener('click', () => {
            document.getElementById('newAddressForm').classList.add('hidden');
            document.getElementById('addressOptions').classList.remove('hidden');
            localStorage.removeItem('editingAddressIndex');
        });

        // Alternate Mobile No. Validation
        document.getElementById('altPhone').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
        });

        // Payment Method
        document.getElementById('paymentMethod').addEventListener('click', () => {
            alert('Payment method set to Online');
        });

        // Order Type and Gift Modal
        let orderType = 'own';
        document.getElementById('ownOrder').addEventListener('click', () => {
            document.getElementById('ownOrder').classList.add('bg-white', 'border', 'border-primary', 'text-primary');
            document.getElementById('ownOrder').classList.remove('bg-primary', 'text-white');
            document.getElementById('giftOrder').classList.remove('bg-primary', 'text-white');
            document.getElementById('giftOrder').classList.add('bg-white', 'border', 'border-primary', 'text-primary');
            orderType = 'own';
            document.getElementById('giftModal').style.display = 'none';
        });
        document.getElementById('giftOrder').addEventListener('click', () => {
            document.getElementById('giftOrder').classList.add('bg-primary', 'text-white');
            document.getElementById('giftOrder').classList.remove('bg-white', 'border', 'border-primary', 'text-primary');
            document.getElementById('ownOrder').classList.remove('bg-primary', 'text-white');
            document.getElementById('ownOrder').classList.add('bg-white', 'border', 'border-primary', 'text-primary');
            orderType = 'gift';
            document.getElementById('giftModal').style.display = 'block';
        });

        // Gift Modal Control
        document.querySelector('.close').addEventListener('click', () => {
            document.getElementById('giftModal').style.display = 'none';
        });
        document.getElementById('saveGiftDetails').addEventListener('click', () => {
            const recipientName = document.getElementById('recipientName').value;
            const recipientPhone = document.getElementById('recipientPhone').value;
            const giftMessage = document.getElementById('giftMessage').value;
            if (recipientName && recipientPhone && recipientPhone.length === 10) {
                alert(`Gift Order Saved!\nRecipient: ${recipientName}\nPhone: ${recipientPhone}\nMessage: ${giftMessage || 'No message'}`);
                document.getElementById('giftModal').style.display = 'none';
            } else {
                alert('Please fill in all required fields correctly!');
            }
        });

        // Discount
        let discount = 25;
        document.getElementById('applyDiscount').addEventListener('click', () => {
            const code = document.getElementById('discountCode').value;
            if (code === 'SAVE25') {
                alert('Discount of ₹25 applied!');
                discount = 25;
            } else {
                alert('Invalid discount code!');
                discount = 0;
            }
            updateSummary();
        });

        // Quantity and Remove Item
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('qty-minus')) {
                const index = e.target.dataset.index;
                if (cartItems[index].quantity > 1) cartItems[index].quantity--;
                else cartItems.splice(index, 1);
                renderCartItems();
                localStorage.setItem('cart', JSON.stringify(cartItems)); // Save updated cart
            }
            if (e.target.classList.contains('qty-plus')) {
                const index = e.target.dataset.index;
                cartItems[index].quantity++;
                renderCartItems();
                localStorage.setItem('cart', JSON.stringify(cartItems)); // Save updated cart
            }
            if (e.target.classList.contains('remove-item')) {
                const index = e.target.dataset.index;
                cartItems.splice(index, 1);
                renderCartItems();
                localStorage.setItem('cart', JSON.stringify(cartItems)); // Save updated cart
            }
        });

        // Add More Items
        document.getElementById('addMoreItems').addEventListener('click', () => {
            window.location.href = '/shop';
        });

        // Update Summary
        function updateSummary() {
            const subTotal = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const deliveryCharge = 0;
            const total = subTotal + deliveryCharge - discount;

            const summaryDiv = document.getElementById('orderSummary');
            summaryDiv.innerHTML = `
                <div class="flex justify-between">
                    <span class="text-dark">Sub Total</span>
                    <span class="text-dark">₹${subTotal}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-dark">Delivery</span>
                    <span class="text-dark">+₹${deliveryCharge}.00</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-dark">Charges</span>
                    <span class="text-dark">+₹0.00</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-dark">Discount</span>
                    <span class="text-dark">-₹${discount}</span>
                </div>
                <hr class="my-2">
                <div class="flex justify-between font-bold text-lg">
                    <span class="text-dark">Total</span>
                    <span class="text-dark">₹${total}</span>
                </div>
            `;
        }

        // Place Order
        document.getElementById('placeOrder').addEventListener('click', () => {
            const name = document.getElementById('orderName').value;
            const phone = document.getElementById('orderPhone').value;
            const altPhone = document.getElementById('altPhone').value;
            const address = document.querySelector('input[name="address"]:checked')?.value || '';
            const total = parseInt(document.getElementById('orderSummary').lastChild.textContent.split('₹')[1]);

            if (!name || !phone || !address || phone.length !== 10) {
                alert('Please fill all required fields correctly!');
                return;
            }

            const orderDetails = {
                name, phone, altPhone, address, orderType, total, items: cartItems
            };
            console.log('Order placed:', orderDetails);
            alert(`Order placed successfully! Total: ₹${total.toLocaleString('en-IN')}\nDetails: ${name}, ${phone}, ${address}`);
            localStorage.removeItem('cart'); // Clear cart after successful order
            window.location.href = 'index.html'; // Redirect to home page
        });

        // Initialize
        renderAddresses();
        renderCartItems();
        document.getElementById('ownOrder').classList.add('bg-white', 'border', 'border-primary', 'text-primary');
        document.getElementById('ownOrder').classList.remove('bg-primary', 'text-white');
        document.getElementById('giftOrder').classList.add('bg-white', 'border', 'border-primary', 'text-primary');
        document.getElementById('giftOrder').classList.remove('bg-primary', 'text-white');
        const today = new Date();
        document.getElementById('selectedDate').textContent = `Today, ${today.toLocaleString('en-US', { month: 'long', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true })} IST`;
    </script>
</body>
</html>